<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://ssl.gstatic.com/docs/script/css/add-ons.css" rel="stylesheet" />
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <title>Google Picker Uploader</title>
</head>
<body>
    <div id="g_id_onload"
         data-client_id="320039054088-qfva8vns5puhqk3d295b57djh36lqe6a.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin" data-type="standard"></div>
    <button id="uploadButton" style="display: none;">ファイルをアップロード</button>
    <div id="result"></div>

    <script>
        var API_KEY = 'AIzaSyDYUGIhOn2eK-L2X931X0UC-R0mX0sDXMA';
        var SCOPES = 'https://www.googleapis.com/auth/drive.file';
        var pickerApiLoaded = false;
        var tokenClient;
        var accessToken = null;
        
        // Google Identity Services の認証を初期化
        function handleCredentialResponse(response) {
            accessToken = response.credential;
            document.getElementById('uploadButton').style.display = 'block';
        }

        function initializePicker() {
            gapi.load('picker', { 'callback': onPickerApiLoad });
        }

        function onPickerApiLoad() {
            pickerApiLoaded = true;
        }

        document.getElementById('uploadButton').onclick = function() {
            createPicker();
        };

        function createPicker() {
            if (pickerApiLoaded && accessToken) {
                var uploadView = new google.picker.DocsUploadView();
                var picker = new google.picker.PickerBuilder()
                    .addView(uploadView)
                    .setOAuthToken(accessToken)
                    .setDeveloperKey(API_KEY)
                    .setCallback(pickerCallback)
                    .build();
                picker.setVisible(true);
            }
        }

        function pickerCallback(data) {
            if (data.action == google.picker.Action.PICKED) {
                var fileId = data.docs[0].id;
                var fileUrl = "https://drive.google.com/file/d/" + fileId + "/view?usp=sharing";
                document.getElementById('result').innerHTML = 
                    '<p>ファイルをアップロードしました: <a href="' + fileUrl + '" target="_blank">' + fileUrl + '</a></p>';
            }
        }

        initializePicker();
    </script>
</body>
</html>
